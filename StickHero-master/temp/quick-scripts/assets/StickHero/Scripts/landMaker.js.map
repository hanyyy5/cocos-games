{"version":3,"sources":["landMaker.js"],"names":["spriteCreator","require","perfectLabel","storageManager","fsm","gameDirector","index","cc","Class","extends","Component","properties","landRange","v2","landWidth","hero","Node","firstLand","secondLand","moveDuration","stickSpeed","heroMoveSpeed","stickWidth","canvas","scoreLabel","Label","hightestScoreLabel","overLabel","onLoad","StateMachine","data","init","transitions","name","from","to","methods","onLeaveHeroTicked","unregisterEvent","onStickLengthen","stickLengthen","stick","createStick","x","width","anchorX","ani","getComponent","Animation","play","onHeroTick","console","log","y","onStickFall","stickFall","rotateBy","easing","easeIn","callFunc","stickLength","height","currentLandRange","heroMoveToStickEnd","heroMoveToLand","perfect","getScore","pl","showPerfect","se","sequence","runAction","onHeroMoveToLand","stop","landMove","heroMove","length","onLandMove","registerEvent","landCreateAndMove","onHeroMoveToStickEnd","heroDown","onHeroDown","gameOver","stickAndHeroDownAction","onGameOver","director","preloadScene","sys","localStorage","setItem","getLastScore","loadScene","bind","onRestart","runLength","score","heroWorldPosX","changeHightestScoreLabel","createNewLand","range","getLandRange","setPosition","on","event","target","EventType","TOUCH_START","touchStart","node","TOUCH_END","touchEnd","TOUCH_CANCEL","touchCancel","targetOff","update","dt","heroTick","stickAction","heroAction","moveBy","seq","time","winSize","getWinSize","action","l","secondAction","parent","getLandWidth","num","getHighestScore","setHighestScore","string","Math","random","module","exports"],"mappings":"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","file":"landMaker.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\StickHero\\Scripts","sourcesContent":["var spriteCreator = require(\"spriteCreator\");\r\nvar perfectLabel = require(\"perfectLabel\");\r\nvar storageManager = require(\"storageManager\");\r\nvar fsm;\r\nvar gameDirector = null;\r\nvar index = 0;\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        landRange:cc.v2(20,300),\r\n        landWidth:cc.v2(20,200),\r\n        hero:cc.Node,\r\n        firstLand:cc.Node,\r\n        secondLand:cc.Node,\r\n        moveDuration:0.5,\r\n        stickSpeed:400,\r\n        heroMoveSpeed:400,\r\n        // stick:cc.Node,\r\n        // stickLengthen:false,\r\n        stickWidth:14,\r\n        canvas:cc.Node,\r\n        scoreLabel:cc.Label,\r\n        hightestScoreLabel:cc.Label,\r\n        overLabel:cc.Label,\r\n        perfectLabel:cc.Node\r\n    },\r\n    onLoad: function () {\r\n        fsm = new StateMachine({\r\n            data:{\r\n                gameDirector:null,\r\n            },\r\n            init: 'stand',\r\n            transitions:[\r\n                {name:'stickLengthen',from:'stand',to:'stickLengthened'},\r\n                {name:'heroTick',from:'stickLengthened',to:'heroTicked'},\r\n                {name:'stickFall',from:'heroTicked',to:'stickFalled'},\r\n                {name:'heroMoveToLand',from:'stickFalled',to:'heroMovedToLand'},\r\n                {name:'landMove',from:'heroMovedToLand',to:'stand'},\r\n                {name:'heroMoveToStickEnd',from:'stickFalled',to:'heroMovedToStickEnd'},\r\n                {name:'heroDown',from:'heroMovedToStickEnd',to:'heroDowned'},\r\n                {name:'gameOver',from:'heroDowned',to:'end'},\r\n                {name:'restart',from:'end',to:'stand'},\r\n            ],\r\n            methods:{\r\n                onLeaveHeroTicked(){\r\n                    gameDirector.unregisterEvent();\r\n                },\r\n                onStickLengthen(){\r\n                    gameDirector.stickLengthen = true;\r\n                    gameDirector.stick = gameDirector.createStick();\r\n                    gameDirector.stick.x = gameDirector.hero.x + gameDirector.hero.width * (1-gameDirector.hero.anchorX) + gameDirector.stick.width * gameDirector.stick.anchorX;\r\n                    var ani = gameDirector.hero.getComponent(cc.Animation);\r\n                    ani.play('heroPush');\r\n                },\r\n                onHeroTick(){\r\n                    gameDirector.stickLengthen = false;\r\n                    var ani = gameDirector.hero.getComponent(cc.Animation);\r\n                    console.log(\"begin tick the stick and output the pos:\", gameDirector.hero.x, gameDirector.hero.y)\r\n                    ani.play('heroTick');\r\n                },\r\n                onStickFall(){\r\n                    //stick fall action.\r\n                    var stickFall = cc.rotateBy(0.5, 90);\r\n                    stickFall.easing(cc.easeIn(3));\r\n                    var callFunc = cc.callFunc(function(){\r\n                        var stickLength = gameDirector.stick.height-gameDirector.stick.width * gameDirector.stick.anchorX;\r\n                        if(stickLength < gameDirector.currentLandRange || stickLength > gameDirector.currentLandRange+gameDirector.secondLand.width){//failed.\r\n                            fsm.heroMoveToStickEnd();\r\n                        }else{//successed\r\n                            fsm.heroMoveToLand();\r\n                            if(stickLength > gameDirector.currentLandRange + gameDirector.secondLand.width/2-5 \r\n                                &&stickLength < gameDirector.currentLandRange + gameDirector.secondLand.width/2+5){\r\n                                gameDirector.perfect ++;\r\n                                gameDirector.getScore(gameDirector.perfect);\r\n                                var pl = gameDirector.perfectLabel.getComponent(perfectLabel);\r\n                                pl.showPerfect(gameDirector.perfect);\r\n                            }else{\r\n                                gameDirector.perfect = 0;\r\n                            }\r\n                        }\r\n                    });\r\n                    var se =cc.sequence(stickFall,callFunc);\r\n                    gameDirector.stick.runAction(se);\r\n                },\r\n                onHeroMoveToLand(){\r\n                    var ani = gameDirector.hero.getComponent(cc.Animation);\r\n                    var callFunc = cc.callFunc(function(){\r\n                        ani.stop('heroRun');\r\n                        gameDirector.getScore();\r\n                        fsm.landMove();\r\n                    });\r\n                    ani.play('heroRun');\r\n                    gameDirector.heroMove(gameDirector.hero,{length:gameDirector.currentLandRange+gameDirector.secondLand.width,callFunc:callFunc});\r\n                },\r\n                onLandMove(){\r\n                    var callFunc = cc.callFunc(function(){\r\n                        gameDirector.registerEvent();\r\n                    });\r\n                    gameDirector.landCreateAndMove(callFunc);\r\n                },\r\n                onHeroMoveToStickEnd(){\r\n                    var ani = gameDirector.hero.getComponent(cc.Animation);\r\n                    var callFunc = cc.callFunc(function(){\r\n                        ani.stop('heroRun');\r\n                        fsm.heroDown();\r\n                    });\r\n                    ani.play('heroRun');\r\n                    gameDirector.heroMove(gameDirector.hero,{length:gameDirector.stick.height,callFunc:callFunc});\r\n                },\r\n                onHeroDown(){\r\n                     var callFunc = cc.callFunc(function(){\r\n                        fsm.gameOver();\r\n                    });\r\n                    gameDirector.stickAndHeroDownAction(callFunc);\r\n                },\r\n                onGameOver(){\r\n                    // gameDirector.overLabel.node.active = true;\r\n                    cc.director.preloadScene(\"GameoverScene\", function () {\r\n                        cc.sys.localStorage.setItem(\"score\",  gameDirector.getLastScore());\r\n                        cc.director.loadScene(\"GameoverScene\");\r\n                    }.bind(this));\r\n                },\r\n                onRestart(){\r\n                    cc.director.loadScene(\"MainGameScene\");\r\n                }\r\n            }\r\n        })\r\n        //init data\r\n        // alert(storageManager.getHighestScore());\r\n        gameDirector = this;\r\n        this.runLength = 0,\r\n        this.stick = null;\r\n        this.stickLengthen = false;\r\n        this.score = 0;\r\n        this.perfect = 0;\r\n        this.currentLandRange = 0;\r\n        this.heroWorldPosX = 0;\r\n        this.changeHightestScoreLabel();\r\n\r\n        //create new land;\r\n        this.createNewLand();\r\n        var range = this.getLandRange();\r\n        this.heroWorldPosX = this.firstLand.width - (1-this.hero.anchorX) * this.hero.width - this.stickWidth;\r\n        this.secondLand.setPosition(range+this.firstLand.width,0);\r\n        \r\n        this.registerEvent();\r\n        //init hero animation callback.\r\n        var ani = gameDirector.hero.getComponent(cc.Animation);\r\n        ani.on('stop',(event, target)=>{\r\n            if(target.name =='heroTick'){\r\n                console.log(\"tick ani stop-------------\", gameDirector.hero.x)\r\n                fsm.stickFall();\r\n            }\r\n        });\r\n    },\r\n    registerEvent(){\r\n        this.canvas.on(cc.Node.EventType.TOUCH_START, this.touchStart.bind(this), this.node);\r\n        this.canvas.on(cc.Node.EventType.TOUCH_END,this.touchEnd.bind(this), this.node);\r\n        this.canvas.on(cc.Node.EventType.TOUCH_CANCEL,this.touchCancel.bind(this), this.node);\r\n        console.log(\"on\");\r\n    },\r\n    unregisterEvent(){\r\n        this.canvas.targetOff(this.node);\r\n        console.log(\"off\");\r\n    },\r\n    update(dt){\r\n        // console.log(dt);\r\n        if(this.stickLengthen){\r\n            this.stick.height += dt*this.stickSpeed;\r\n            // this.stick.height = this.currentLandRange + this.secondLand.width/2;\r\n        }\r\n    },\r\n    touchStart(event){\r\n        fsm.stickLengthen();\r\n        cc.log(\"touchStart\");\r\n    },\r\n    touchEnd(event){\r\n        fsm.heroTick();\r\n        cc.log(\"touchEnd\");\r\n    },\r\n    touchCancel(){\r\n        this.touchEnd();\r\n        cc.log(\"touchCancel\");\r\n    },\r\n    stickAndHeroDownAction(callFunc){\r\n        //stick down action;\r\n        var stickAction = cc.rotateBy(0.5, 90);\r\n        stickAction.easing(cc.easeIn(3));\r\n        this.stick.runAction(stickAction);\r\n        //hero down action;\r\n        var heroAction = cc.moveBy(0.5,cc.v2(0,-300 - this.hero.height));\r\n        heroAction.easing(cc.easeIn(3));\r\n        var seq =cc.sequence(heroAction,callFunc);\r\n        this.hero.runAction(seq);\r\n    },\r\n    heroMove(target,data){\r\n        var time = data.length/this.heroMoveSpeed;\r\n        console.log(\"hero move distance is ========================\", data.length)\r\n        var heroMove = cc.moveBy(time,cc.v2(data.length,0));\r\n        if(data.callFunc){\r\n            console.log(\"this move has data.callFunc============\", data.callFunc, data.length)\r\n            var se =cc.sequence(heroMove,data.callFunc);\r\n            this.hero.runAction(se);\r\n        }else{\r\n            this.hero.runAction(heroMove);\r\n        }\r\n    },\r\n    landCreateAndMove(callFunc) {\r\n        var winSize = cc.director.getWinSize();\r\n        //firstland;\r\n        var length = this.currentLandRange + this.secondLand.width;\r\n        this.runLength +=length;\r\n        var action = cc.moveBy(this.moveDuration,cc.v2(-length,0));\r\n        this.node.runAction(action);\r\n        this.firstLand = this.secondLand;\r\n\r\n        this.createNewLand();\r\n\r\n        //landRange\r\n        var range = this.getLandRange();\r\n\r\n        //secondland;\r\n        this.secondLand.setPosition(this.runLength+winSize.width,0);\r\n        var l = winSize.width - range - this.heroWorldPosX - this.hero.width * this.hero.anchorX - this.stickWidth;\r\n        var secondAction = cc.moveBy(this.moveDuration,cc.v2(-l,0));\r\n        var seq =cc.sequence(secondAction,callFunc);\r\n        this.secondLand.runAction(seq);\r\n    },\r\n    createStick(){\r\n        cc.log(\"sc\");\r\n        var stick = spriteCreator.createStick(this.stickWidth);\r\n        stick.parent = this.node;\r\n        return stick\r\n    },\r\n    createNewLand() {\r\n        this.secondLand = spriteCreator.createNewLand(this.getLandWidth());\r\n        // console.log(\"secondLand\", this.secondLand.getComponent(cc.Sprite))\r\n        this.secondLand.parent = this.node;\r\n    },\r\n    getScore(num){\r\n        if(num){\r\n            this.score += num;  \r\n        }else{\r\n            this.score++;\r\n        }\r\n        if(storageManager.getHighestScore()<this.score){\r\n            storageManager.setHighestScore(this.score);\r\n            this.changeHightestScoreLabel();\r\n        }\r\n        this.scoreLabel.string = this.score;\r\n        return this.score;\r\n    },\r\n    getLastScore(){\r\n        return this.score\r\n    },\r\n    changeHightestScoreLabel(){\r\n        this.hightestScoreLabel.string = \"最高分:\" + storageManager.getHighestScore();\r\n    },\r\n    getLandRange(){\r\n        this.currentLandRange = this.landRange.x +(this.landRange.y - this.landRange.x)*Math.random();\r\n        var winSize = cc.director.getWinSize();\r\n        if(winSize.width < this.currentLandRange + this.heroWorldPosX + this.hero.width + this.secondLand.width){\r\n            this.currentLandRange = winSize.width - this.heroWorldPosX - this.hero.width - this.secondLand.width;\r\n        }\r\n        return this.currentLandRange;\r\n    },\r\n    getLandWidth(){\r\n        return this.landWidth.x + (this.landWidth.y - this.landWidth.x)* Math.random();\r\n    }\r\n});\r\nmodule.exports = fsm;"]}