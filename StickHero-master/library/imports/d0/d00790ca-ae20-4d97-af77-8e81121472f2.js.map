{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\StickHero\\Scripts/assets\\StickHero\\Scripts\\landMaker.js"],"names":["spriteCreator","require","perfectLabel","storageManager","fsm","StateMachine","data","gameDirector","init","transitions","name","from","to","methods","onLeaveHeroTicked","unregisterEvent","onStickLengthen","stickLengthen","stick","createStick","x","hero","width","anchorX","ani","getComponent","cc","Animation","play","onHeroTick","onStickFall","stickFall","rotateBy","easing","easeIn","callFunc","stickLength","height","currentLandRange","secondLand","heroMoveToStickEnd","heroMoveToLand","perfect","getScore","pl","showPerfect","se","sequence","runAction","onHeroMoveToLand","stop","landMove","heroMove","length","onLandMove","registerEvent","landCreateAndMove","onHeroMoveToStickEnd","heroDown","onHeroDown","gameOver","stickAndHeroDownAction","onGameOver","director","preloadScene","sys","localStorage","setItem","loadScene","bind","onRestart","Class","extends","Component","properties","landRange","v2","landWidth","Node","firstLand","moveDuration","stickSpeed","heroMoveSpeed","stickWidth","canvas","scoreLabel","Label","hightestScoreLabel","overLabel","onLoad","runLength","score","heroWorldPosX","changeHightestScoreLabel","createNewLand","range","getLandRange","setPosition","on","event","target","EventType","TOUCH_START","touchStart","node","TOUCH_END","touchEnd","TOUCH_CANCEL","touchCancel","console","log","targetOff","update","dt","heroTick","stickAction","heroAction","moveBy","p","seq","time","winSize","getWinSize","action","l","secondAction","parent","getLandWidth","num","getHighestScore","setHighestScore","string","y","Math","random","module","exports"],"mappings":";;;;;;AAAA,IAAIA,gBAAgBC,QAAQ,eAAR,CAApB;AACA,IAAIC,eAAeD,QAAQ,cAAR,CAAnB;AACA,IAAIE,iBAAiBF,QAAQ,gBAAR,CAArB;AACA,IAAIG,MAAM,IAAIC,YAAJ,CAAiB;AACvBC,UAAK;AACDC,sBAAa;AADZ,KADkB;AAIvBC,UAAM,OAJiB;AAKvBC,iBAAY,CACR,EAACC,MAAK,eAAN,EAAsBC,MAAK,OAA3B,EAAmCC,IAAG,iBAAtC,EADQ,EAER,EAACF,MAAK,UAAN,EAAiBC,MAAK,iBAAtB,EAAwCC,IAAG,YAA3C,EAFQ,EAGR,EAACF,MAAK,WAAN,EAAkBC,MAAK,YAAvB,EAAoCC,IAAG,aAAvC,EAHQ,EAIR,EAACF,MAAK,gBAAN,EAAuBC,MAAK,aAA5B,EAA0CC,IAAG,iBAA7C,EAJQ,EAKR,EAACF,MAAK,UAAN,EAAiBC,MAAK,iBAAtB,EAAwCC,IAAG,OAA3C,EALQ,EAMR,EAACF,MAAK,oBAAN,EAA2BC,MAAK,aAAhC,EAA8CC,IAAG,qBAAjD,EANQ,EAOR,EAACF,MAAK,UAAN,EAAiBC,MAAK,qBAAtB,EAA4CC,IAAG,YAA/C,EAPQ,EAQR,EAACF,MAAK,UAAN,EAAiBC,MAAK,YAAtB,EAAmCC,IAAG,KAAtC,EARQ,EASR,EAACF,MAAK,SAAN,EAAgBC,MAAK,KAArB,EAA2BC,IAAG,OAA9B,EATQ,CALW;AAgBvBC,aAAQ;AACJC,yBADI,+BACe;AACfP,yBAAaQ,eAAb;AACH,SAHG;AAIJC,uBAJI,6BAIa;AACbT,yBAAaU,aAAb,GAA6B,IAA7B;AACAV,yBAAaW,KAAb,GAAqBX,aAAaY,WAAb,EAArB;AACAZ,yBAAaW,KAAb,CAAmBE,CAAnB,GAAuBb,aAAac,IAAb,CAAkBD,CAAlB,GAAsBb,aAAac,IAAb,CAAkBC,KAAlB,IAA2B,IAAEf,aAAac,IAAb,CAAkBE,OAA/C,CAAtB,GAAgFhB,aAAaW,KAAb,CAAmBI,KAAnB,GAA2Bf,aAAaW,KAAb,CAAmBK,OAArJ;AACA,gBAAIC,MAAMjB,aAAac,IAAb,CAAkBI,YAAlB,CAA+BC,GAAGC,SAAlC,CAAV;AACAH,gBAAII,IAAJ,CAAS,UAAT;AACH,SAVG;AAWJC,kBAXI,wBAWQ;AACRtB,yBAAaU,aAAb,GAA6B,KAA7B;AACA,gBAAIO,MAAMjB,aAAac,IAAb,CAAkBI,YAAlB,CAA+BC,GAAGC,SAAlC,CAAV;AACAH,gBAAII,IAAJ,CAAS,UAAT;AACH,SAfG;AAgBJE,mBAhBI,yBAgBS;AACT;AACA,gBAAIC,YAAYL,GAAGM,QAAH,CAAY,GAAZ,EAAiB,EAAjB,CAAhB;AACAD,sBAAUE,MAAV,CAAiBP,GAAGQ,MAAH,CAAU,CAAV,CAAjB;AACA,gBAAIC,WAAWT,GAAGS,QAAH,CAAY,YAAU;AACjC,oBAAIC,cAAc7B,aAAaW,KAAb,CAAmBmB,MAAnB,GAA0B9B,aAAaW,KAAb,CAAmBI,KAAnB,GAA2Bf,aAAaW,KAAb,CAAmBK,OAA1F;AACA,oBAAGa,cAAc7B,aAAa+B,gBAA3B,IAA+CF,cAAc7B,aAAa+B,gBAAb,GAA8B/B,aAAagC,UAAb,CAAwBjB,KAAtH,EAA4H;AAAC;AACzHlB,wBAAIoC,kBAAJ;AACH,iBAFD,MAEK;AAAC;AACFpC,wBAAIqC,cAAJ;AACA,wBAAGL,cAAc7B,aAAa+B,gBAAb,GAAgC/B,aAAagC,UAAb,CAAwBjB,KAAxB,GAA8B,CAA9D,GAAgE,CAA9E,IACGc,cAAc7B,aAAa+B,gBAAb,GAAgC/B,aAAagC,UAAb,CAAwBjB,KAAxB,GAA8B,CAA9D,GAAgE,CADpF,EACsF;AAClFf,qCAAamC,OAAb;AACAnC,qCAAaoC,QAAb,CAAsBpC,aAAamC,OAAnC;AACA,4BAAIE,KAAKrC,aAAaL,YAAb,CAA0BuB,YAA1B,CAAuCvB,YAAvC,CAAT;AACA0C,2BAAGC,WAAH,CAAetC,aAAamC,OAA5B;AACH,qBAND,MAMK;AACDnC,qCAAamC,OAAb,GAAuB,CAAvB;AACH;AACJ;AACJ,aAhBc,CAAf;AAiBA,gBAAII,KAAIpB,GAAGqB,QAAH,CAAYhB,SAAZ,EAAsBI,QAAtB,CAAR;AACA5B,yBAAaW,KAAb,CAAmB8B,SAAnB,CAA6BF,EAA7B;AACH,SAvCG;AAwCJG,wBAxCI,8BAwCc;AACd,gBAAIzB,MAAMjB,aAAac,IAAb,CAAkBI,YAAlB,CAA+BC,GAAGC,SAAlC,CAAV;AACA,gBAAIQ,WAAWT,GAAGS,QAAH,CAAY,YAAU;AACjCX,oBAAI0B,IAAJ,CAAS,SAAT;AACA3C,6BAAaoC,QAAb;AACAvC,oBAAI+C,QAAJ;AACH,aAJc,CAAf;AAKA3B,gBAAII,IAAJ,CAAS,SAAT;AACArB,yBAAa6C,QAAb,CAAsB7C,aAAac,IAAnC,EAAwC,EAACgC,QAAO9C,aAAa+B,gBAAb,GAA8B/B,aAAagC,UAAb,CAAwBjB,KAA9D,EAAoEa,UAASA,QAA7E,EAAxC;AACH,SAjDG;AAkDJmB,kBAlDI,wBAkDQ;AACR,gBAAInB,WAAWT,GAAGS,QAAH,CAAY,YAAU;AACjC5B,6BAAagD,aAAb;AACH,aAFc,CAAf;AAGAhD,yBAAaiD,iBAAb,CAA+BrB,QAA/B;AACH,SAvDG;AAwDJsB,4BAxDI,kCAwDkB;AAClB,gBAAIjC,MAAMjB,aAAac,IAAb,CAAkBI,YAAlB,CAA+BC,GAAGC,SAAlC,CAAV;AACA,gBAAIQ,WAAWT,GAAGS,QAAH,CAAY,YAAU;AACjCX,oBAAI0B,IAAJ,CAAS,SAAT;AACA9C,oBAAIsD,QAAJ;AACH,aAHc,CAAf;AAIAlC,gBAAII,IAAJ,CAAS,SAAT;AACArB,yBAAa6C,QAAb,CAAsB7C,aAAac,IAAnC,EAAwC,EAACgC,QAAO9C,aAAaW,KAAb,CAAmBmB,MAA3B,EAAkCF,UAASA,QAA3C,EAAxC;AACH,SAhEG;AAiEJwB,kBAjEI,wBAiEQ;AACP,gBAAIxB,WAAWT,GAAGS,QAAH,CAAY,YAAU;AAClC/B,oBAAIwD,QAAJ;AACH,aAFe,CAAf;AAGDrD,yBAAasD,sBAAb,CAAoC1B,QAApC;AACH,SAtEG;AAuEJ2B,kBAvEI,wBAuEQ;AACR;AACApC,eAAGqC,QAAH,CAAYC,YAAZ,CAAyB,eAAzB,EAA0C,YAAY;AAClDtC,mBAAGuC,GAAH,CAAOC,YAAP,CAAoBC,OAApB,CAA4B,OAA5B,EAAsC5D,aAAaoC,QAAb,EAAtC;AACAjB,mBAAGqC,QAAH,CAAYK,SAAZ,CAAsB,eAAtB;AACH,aAHyC,CAGxCC,IAHwC,CAGnC,IAHmC,CAA1C;AAIH,SA7EG;AA8EJC,iBA9EI,uBA8EO;AACP5C,eAAGqC,QAAH,CAAYK,SAAZ,CAAsB,eAAtB;AACH;AAhFG;AAhBe,CAAjB,CAAV;AAmGA,IAAI7D,eAAe,IAAnB;AACAmB,GAAG6C,KAAH,CAAS;AACLC,aAAS9C,GAAG+C,SADP;AAELC,gBAAY;AACRC,mBAAUjD,GAAGkD,EAAH,CAAM,EAAN,EAAS,GAAT,CADF;AAERC,mBAAUnD,GAAGkD,EAAH,CAAM,EAAN,EAAS,GAAT,CAFF;AAGRvD,cAAKK,GAAGoD,IAHA;AAIRC,mBAAUrD,GAAGoD,IAJL;AAKRvC,oBAAWb,GAAGoD,IALN;AAMRE,sBAAa,GANL;AAORC,oBAAW,GAPH;AAQRC,uBAAc,GARN;AASR;AACA;AACAC,oBAAW,CAXH;AAYRC,gBAAO1D,GAAGoD,IAZF;AAaRO,oBAAW3D,GAAG4D,KAbN;AAcRC,4BAAmB7D,GAAG4D,KAdd;AAeRE,mBAAU9D,GAAG4D,KAfL;AAgBRpF,sBAAawB,GAAGoD;AAhBR,KAFP;AAoBLW,YAAQ,kBAAY;AAChB;AACA;AACAlF,uBAAe,IAAf;AACA,aAAKmF,SAAL,GAAiB,CAAjB,EACA,KAAKxE,KAAL,GAAa,IADb;AAEA,aAAKD,aAAL,GAAqB,KAArB;AACA,aAAK0E,KAAL,GAAa,CAAb;AACA,aAAKjD,OAAL,GAAe,CAAf;AACA,aAAKJ,gBAAL,GAAwB,CAAxB;AACA,aAAKsD,aAAL,GAAqB,CAArB;AACA,aAAKC,wBAAL;;AAEA;AACA,aAAKC,aAAL;AACA,YAAIC,QAAQ,KAAKC,YAAL,EAAZ;AACA,aAAKJ,aAAL,GAAqB,KAAKb,SAAL,CAAezD,KAAf,GAAuB,CAAC,IAAE,KAAKD,IAAL,CAAUE,OAAb,IAAwB,KAAKF,IAAL,CAAUC,KAAzD,GAAiE,KAAK6D,UAA3F;AACA,aAAK5C,UAAL,CAAgB0D,WAAhB,CAA4BF,QAAM,KAAKhB,SAAL,CAAezD,KAAjD,EAAuD,CAAvD;;AAEA,aAAKiC,aAAL;AACA;AACA,YAAI/B,MAAMjB,aAAac,IAAb,CAAkBI,YAAlB,CAA+BC,GAAGC,SAAlC,CAAV;AACAH,YAAI0E,EAAJ,CAAO,MAAP,EAAc,UAACC,KAAD,EAAQC,MAAR,EAAiB;AAC3B,gBAAGA,OAAO1F,IAAP,IAAc,UAAjB,EAA4B;AACxBN,oBAAI2B,SAAJ;AACH;AACJ,SAJD;AAKH,KA/CI;AAgDLwB,iBAhDK,2BAgDU;AACX,aAAK6B,MAAL,CAAYc,EAAZ,CAAexE,GAAGoD,IAAH,CAAQuB,SAAR,CAAkBC,WAAjC,EAA8C,KAAKC,UAAL,CAAgBlC,IAAhB,CAAqB,IAArB,CAA9C,EAA0E,KAAKmC,IAA/E;AACA,aAAKpB,MAAL,CAAYc,EAAZ,CAAexE,GAAGoD,IAAH,CAAQuB,SAAR,CAAkBI,SAAjC,EAA2C,KAAKC,QAAL,CAAcrC,IAAd,CAAmB,IAAnB,CAA3C,EAAqE,KAAKmC,IAA1E;AACA,aAAKpB,MAAL,CAAYc,EAAZ,CAAexE,GAAGoD,IAAH,CAAQuB,SAAR,CAAkBM,YAAjC,EAA8C,KAAKC,WAAL,CAAiBvC,IAAjB,CAAsB,IAAtB,CAA9C,EAA2E,KAAKmC,IAAhF;AACAK,gBAAQC,GAAR,CAAY,IAAZ;AACH,KArDI;AAsDL/F,mBAtDK,6BAsDY;AACb,aAAKqE,MAAL,CAAY2B,SAAZ,CAAsB,KAAKP,IAA3B;AACAK,gBAAQC,GAAR,CAAY,KAAZ;AACH,KAzDI;AA0DLE,UA1DK,kBA0DEC,EA1DF,EA0DK;AACN;AACA,YAAG,KAAKhG,aAAR,EAAsB;AAClB,iBAAKC,KAAL,CAAWmB,MAAX,IAAqB4E,KAAG,KAAKhC,UAA7B;AACA;AACH;AACJ,KAhEI;AAiELsB,cAjEK,sBAiEMJ,KAjEN,EAiEY;AACb/F,YAAIa,aAAJ;AACAS,WAAGoF,GAAH,CAAO,YAAP;AACH,KApEI;AAqELJ,YArEK,oBAqEIP,KArEJ,EAqEU;AACX/F,YAAI8G,QAAJ;AACAxF,WAAGoF,GAAH,CAAO,UAAP;AACH,KAxEI;AAyELF,eAzEK,yBAyEQ;AACT,aAAKF,QAAL;AACAhF,WAAGoF,GAAH,CAAO,aAAP;AACH,KA5EI;AA6ELjD,0BA7EK,kCA6EkB1B,QA7ElB,EA6E2B;AAC5B;AACA,YAAIgF,cAAczF,GAAGM,QAAH,CAAY,GAAZ,EAAiB,EAAjB,CAAlB;AACAmF,oBAAYlF,MAAZ,CAAmBP,GAAGQ,MAAH,CAAU,CAAV,CAAnB;AACA,aAAKhB,KAAL,CAAW8B,SAAX,CAAqBmE,WAArB;AACA;AACA,YAAIC,aAAa1F,GAAG2F,MAAH,CAAU,GAAV,EAAc3F,GAAG4F,CAAH,CAAK,CAAL,EAAO,CAAC,GAAD,GAAO,KAAKjG,IAAL,CAAUgB,MAAxB,CAAd,CAAjB;AACA+E,mBAAWnF,MAAX,CAAkBP,GAAGQ,MAAH,CAAU,CAAV,CAAlB;AACA,YAAIqF,MAAK7F,GAAGqB,QAAH,CAAYqE,UAAZ,EAAuBjF,QAAvB,CAAT;AACA,aAAKd,IAAL,CAAU2B,SAAV,CAAoBuE,GAApB;AACH,KAvFI;AAwFLnE,YAxFK,oBAwFIgD,MAxFJ,EAwFW9F,IAxFX,EAwFgB;AACjB,YAAIkH,OAAOlH,KAAK+C,MAAL,GAAY,KAAK6B,aAA5B;AACA,YAAI9B,WAAW1B,GAAG2F,MAAH,CAAUG,IAAV,EAAe9F,GAAG4F,CAAH,CAAKhH,KAAK+C,MAAV,EAAiB,CAAjB,CAAf,CAAf;AACA,YAAG/C,KAAK6B,QAAR,EAAiB;AACb,gBAAIW,KAAIpB,GAAGqB,QAAH,CAAYK,QAAZ,EAAqB9C,KAAK6B,QAA1B,CAAR;AACA,iBAAKd,IAAL,CAAU2B,SAAV,CAAoBF,EAApB;AACH,SAHD,MAGK;AACD,iBAAKzB,IAAL,CAAU2B,SAAV,CAAoBI,QAApB;AACH;AACJ,KAjGI;AAkGLI,qBAlGK,6BAkGarB,QAlGb,EAkGuB;AACxB,YAAIsF,UAAU/F,GAAGqC,QAAH,CAAY2D,UAAZ,EAAd;AACA;AACA,YAAIrE,SAAS,KAAKf,gBAAL,GAAwB,KAAKC,UAAL,CAAgBjB,KAArD;AACA,aAAKoE,SAAL,IAAiBrC,MAAjB;AACA,YAAIsE,SAASjG,GAAG2F,MAAH,CAAU,KAAKrC,YAAf,EAA4BtD,GAAG4F,CAAH,CAAK,CAACjE,MAAN,EAAa,CAAb,CAA5B,CAAb;AACA,aAAKmD,IAAL,CAAUxD,SAAV,CAAoB2E,MAApB;AACA,aAAK5C,SAAL,GAAiB,KAAKxC,UAAtB;;AAEA,aAAKuD,aAAL;;AAEA;AACA,YAAIC,QAAQ,KAAKC,YAAL,EAAZ;;AAEA;AACA,aAAKzD,UAAL,CAAgB0D,WAAhB,CAA4B,KAAKP,SAAL,GAAe+B,QAAQnG,KAAnD,EAAyD,CAAzD;AACA,YAAIsG,IAAIH,QAAQnG,KAAR,GAAgByE,KAAhB,GAAwB,KAAKH,aAA7B,GAA6C,KAAKvE,IAAL,CAAUC,KAAV,GAAkB,KAAKD,IAAL,CAAUE,OAAzE,GAAmF,KAAK4D,UAAhG;AACA,YAAI0C,eAAenG,GAAG2F,MAAH,CAAU,KAAKrC,YAAf,EAA4BtD,GAAG4F,CAAH,CAAK,CAACM,CAAN,EAAQ,CAAR,CAA5B,CAAnB;AACA,YAAIL,MAAK7F,GAAGqB,QAAH,CAAY8E,YAAZ,EAAyB1F,QAAzB,CAAT;AACA,aAAKI,UAAL,CAAgBS,SAAhB,CAA0BuE,GAA1B;AACH,KAtHI;AAuHLpG,eAvHK,yBAuHQ;AACTO,WAAGoF,GAAH,CAAO,IAAP;AACA,YAAI5F,QAAQlB,cAAcmB,WAAd,CAA0B,KAAKgE,UAA/B,CAAZ;AACAjE,cAAM4G,MAAN,GAAe,KAAKtB,IAApB;AACA,eAAOtF,KAAP;AACH,KA5HI;AA6HL4E,iBA7HK,2BA6HW;AACZ,aAAKvD,UAAL,GAAkBvC,cAAc8F,aAAd,CAA4B,KAAKiC,YAAL,EAA5B,CAAlB;AACA,aAAKxF,UAAL,CAAgBuF,MAAhB,GAAyB,KAAKtB,IAA9B;AACH,KAhII;AAiIL7D,YAjIK,oBAiIIqF,GAjIJ,EAiIQ;AACT,YAAGA,GAAH,EAAO;AACH,iBAAKrC,KAAL,IAAcqC,GAAd;AACH,SAFD,MAEK;AACD,iBAAKrC,KAAL;AACH;AACD,YAAGxF,eAAe8H,eAAf,KAAiC,KAAKtC,KAAzC,EAA+C;AAC3CxF,2BAAe+H,eAAf,CAA+B,KAAKvC,KAApC;AACA,iBAAKE,wBAAL;AACH;AACD,aAAKR,UAAL,CAAgB8C,MAAhB,GAAyB,QAAM,KAAKxC,KAApC;AACA,eAAO,KAAKA,KAAZ;AACH,KA7II;AA8ILE,4BA9IK,sCA8IqB;AACtB,aAAKN,kBAAL,CAAwB4C,MAAxB,GAAiC,SAAShI,eAAe8H,eAAf,EAA1C;AACH,KAhJI;AAiJLjC,gBAjJK,0BAiJS;AACV,aAAK1D,gBAAL,GAAwB,KAAKqC,SAAL,CAAevD,CAAf,GAAkB,CAAC,KAAKuD,SAAL,CAAeyD,CAAf,GAAmB,KAAKzD,SAAL,CAAevD,CAAnC,IAAsCiH,KAAKC,MAAL,EAAhF;AACA,YAAIb,UAAU/F,GAAGqC,QAAH,CAAY2D,UAAZ,EAAd;AACA,YAAGD,QAAQnG,KAAR,GAAgB,KAAKgB,gBAAL,GAAwB,KAAKsD,aAA7B,GAA6C,KAAKvE,IAAL,CAAUC,KAAvD,GAA+D,KAAKiB,UAAL,CAAgBjB,KAAlG,EAAwG;AACpG,iBAAKgB,gBAAL,GAAwBmF,QAAQnG,KAAR,GAAgB,KAAKsE,aAArB,GAAqC,KAAKvE,IAAL,CAAUC,KAA/C,GAAuD,KAAKiB,UAAL,CAAgBjB,KAA/F;AACH;AACD,eAAO,KAAKgB,gBAAZ;AACH,KAxJI;AAyJLyF,gBAzJK,0BAyJS;AACV,eAAO,KAAKlD,SAAL,CAAezD,CAAf,GAAmB,CAAC,KAAKyD,SAAL,CAAeuD,CAAf,GAAmB,KAAKvD,SAAL,CAAezD,CAAnC,IAAuCiH,KAAKC,MAAL,EAAjE;AACH;AA3JI,CAAT;AA6JAC,OAAOC,OAAP,GAAiBpI,GAAjB","file":"landMaker.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\StickHero\\Scripts","sourcesContent":["var spriteCreator = require(\"spriteCreator\");\r\nvar perfectLabel = require(\"perfectLabel\");\r\nvar storageManager = require(\"storageManager\");\r\nvar fsm = new StateMachine({\r\n    data:{\r\n        gameDirector:null,\r\n    },\r\n    init: 'stand',\r\n    transitions:[\r\n        {name:'stickLengthen',from:'stand',to:'stickLengthened'},\r\n        {name:'heroTick',from:'stickLengthened',to:'heroTicked'},\r\n        {name:'stickFall',from:'heroTicked',to:'stickFalled'},\r\n        {name:'heroMoveToLand',from:'stickFalled',to:'heroMovedToLand'},\r\n        {name:'landMove',from:'heroMovedToLand',to:'stand'},\r\n        {name:'heroMoveToStickEnd',from:'stickFalled',to:'heroMovedToStickEnd'},\r\n        {name:'heroDown',from:'heroMovedToStickEnd',to:'heroDowned'},\r\n        {name:'gameOver',from:'heroDowned',to:'end'},\r\n        {name:'restart',from:'end',to:'stand'},\r\n    ],\r\n    methods:{\r\n        onLeaveHeroTicked(){\r\n            gameDirector.unregisterEvent();\r\n        },\r\n        onStickLengthen(){\r\n            gameDirector.stickLengthen = true;\r\n            gameDirector.stick = gameDirector.createStick();\r\n            gameDirector.stick.x = gameDirector.hero.x + gameDirector.hero.width * (1-gameDirector.hero.anchorX) + gameDirector.stick.width * gameDirector.stick.anchorX;\r\n            var ani = gameDirector.hero.getComponent(cc.Animation);\r\n            ani.play('heroPush');\r\n        },\r\n        onHeroTick(){\r\n            gameDirector.stickLengthen = false;\r\n            var ani = gameDirector.hero.getComponent(cc.Animation);\r\n            ani.play('heroTick');\r\n        },\r\n        onStickFall(){\r\n            //stick fall action.\r\n            var stickFall = cc.rotateBy(0.5, 90);\r\n            stickFall.easing(cc.easeIn(3));\r\n            var callFunc = cc.callFunc(function(){\r\n                var stickLength = gameDirector.stick.height-gameDirector.stick.width * gameDirector.stick.anchorX;\r\n                if(stickLength < gameDirector.currentLandRange || stickLength > gameDirector.currentLandRange+gameDirector.secondLand.width){//failed.\r\n                    fsm.heroMoveToStickEnd();\r\n                }else{//successed\r\n                    fsm.heroMoveToLand();\r\n                    if(stickLength > gameDirector.currentLandRange + gameDirector.secondLand.width/2-5 \r\n                        &&stickLength < gameDirector.currentLandRange + gameDirector.secondLand.width/2+5){\r\n                        gameDirector.perfect ++;\r\n                        gameDirector.getScore(gameDirector.perfect);\r\n                        var pl = gameDirector.perfectLabel.getComponent(perfectLabel);\r\n                        pl.showPerfect(gameDirector.perfect);\r\n                    }else{\r\n                        gameDirector.perfect = 0;\r\n                    }\r\n                }\r\n            });\r\n            var se =cc.sequence(stickFall,callFunc);\r\n            gameDirector.stick.runAction(se);\r\n        },\r\n        onHeroMoveToLand(){\r\n            var ani = gameDirector.hero.getComponent(cc.Animation);\r\n            var callFunc = cc.callFunc(function(){\r\n                ani.stop('heroRun');\r\n                gameDirector.getScore();\r\n                fsm.landMove();\r\n            });\r\n            ani.play('heroRun');\r\n            gameDirector.heroMove(gameDirector.hero,{length:gameDirector.currentLandRange+gameDirector.secondLand.width,callFunc:callFunc});\r\n        },\r\n        onLandMove(){\r\n            var callFunc = cc.callFunc(function(){\r\n                gameDirector.registerEvent();\r\n            });\r\n            gameDirector.landCreateAndMove(callFunc);\r\n        },\r\n        onHeroMoveToStickEnd(){\r\n            var ani = gameDirector.hero.getComponent(cc.Animation);\r\n            var callFunc = cc.callFunc(function(){\r\n                ani.stop('heroRun');\r\n                fsm.heroDown();\r\n            });\r\n            ani.play('heroRun');\r\n            gameDirector.heroMove(gameDirector.hero,{length:gameDirector.stick.height,callFunc:callFunc});\r\n        },\r\n        onHeroDown(){\r\n             var callFunc = cc.callFunc(function(){\r\n                fsm.gameOver();\r\n            });\r\n            gameDirector.stickAndHeroDownAction(callFunc);\r\n        },\r\n        onGameOver(){\r\n            // gameDirector.overLabel.node.active = true;\r\n            cc.director.preloadScene(\"GameoverScene\", function () {\r\n                cc.sys.localStorage.setItem(\"score\",  gameDirector.getScore());\r\n                cc.director.loadScene(\"GameoverScene\");\r\n            }.bind(this));\r\n        },\r\n        onRestart(){\r\n            cc.director.loadScene(\"MainGameScene\");\r\n        }\r\n    }\r\n});\r\nvar gameDirector = null;\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        landRange:cc.v2(20,300),\r\n        landWidth:cc.v2(20,200),\r\n        hero:cc.Node,\r\n        firstLand:cc.Node,\r\n        secondLand:cc.Node,\r\n        moveDuration:0.5,\r\n        stickSpeed:400,\r\n        heroMoveSpeed:400,\r\n        // stick:cc.Node,\r\n        // stickLengthen:false,\r\n        stickWidth:6,\r\n        canvas:cc.Node,\r\n        scoreLabel:cc.Label,\r\n        hightestScoreLabel:cc.Label,\r\n        overLabel:cc.Label,\r\n        perfectLabel:cc.Node\r\n    },\r\n    onLoad: function () {\r\n        //init data\r\n        // alert(storageManager.getHighestScore());\r\n        gameDirector = this;\r\n        this.runLength = 0,\r\n        this.stick = null;\r\n        this.stickLengthen = false;\r\n        this.score = 0;\r\n        this.perfect = 0;\r\n        this.currentLandRange = 0;\r\n        this.heroWorldPosX = 0;\r\n        this.changeHightestScoreLabel();\r\n\r\n        //create new land;\r\n        this.createNewLand();\r\n        var range = this.getLandRange();\r\n        this.heroWorldPosX = this.firstLand.width - (1-this.hero.anchorX) * this.hero.width - this.stickWidth;\r\n        this.secondLand.setPosition(range+this.firstLand.width,0);\r\n        \r\n        this.registerEvent();\r\n        //init hero animation callback.\r\n        var ani = gameDirector.hero.getComponent(cc.Animation);\r\n        ani.on('stop',(event, target)=>{\r\n            if(target.name =='heroTick'){\r\n                fsm.stickFall();\r\n            }\r\n        });\r\n    },\r\n    registerEvent(){\r\n        this.canvas.on(cc.Node.EventType.TOUCH_START, this.touchStart.bind(this), this.node);\r\n        this.canvas.on(cc.Node.EventType.TOUCH_END,this.touchEnd.bind(this), this.node);\r\n        this.canvas.on(cc.Node.EventType.TOUCH_CANCEL,this.touchCancel.bind(this), this.node);\r\n        console.log(\"on\");\r\n    },\r\n    unregisterEvent(){\r\n        this.canvas.targetOff(this.node);\r\n        console.log(\"off\");\r\n    },\r\n    update(dt){\r\n        // console.log(dt);\r\n        if(this.stickLengthen){\r\n            this.stick.height += dt*this.stickSpeed;\r\n            // this.stick.height = this.currentLandRange + this.secondLand.width/2;\r\n        }\r\n    },\r\n    touchStart(event){\r\n        fsm.stickLengthen();\r\n        cc.log(\"touchStart\");\r\n    },\r\n    touchEnd(event){\r\n        fsm.heroTick();\r\n        cc.log(\"touchEnd\");\r\n    },\r\n    touchCancel(){\r\n        this.touchEnd();\r\n        cc.log(\"touchCancel\");\r\n    },\r\n    stickAndHeroDownAction(callFunc){\r\n        //stick down action;\r\n        var stickAction = cc.rotateBy(0.5, 90);\r\n        stickAction.easing(cc.easeIn(3));\r\n        this.stick.runAction(stickAction);\r\n        //hero down action;\r\n        var heroAction = cc.moveBy(0.5,cc.p(0,-300 - this.hero.height));\r\n        heroAction.easing(cc.easeIn(3));\r\n        var seq =cc.sequence(heroAction,callFunc);\r\n        this.hero.runAction(seq);\r\n    },\r\n    heroMove(target,data){\r\n        var time = data.length/this.heroMoveSpeed;\r\n        var heroMove = cc.moveBy(time,cc.p(data.length,0));\r\n        if(data.callFunc){\r\n            var se =cc.sequence(heroMove,data.callFunc);\r\n            this.hero.runAction(se);\r\n        }else{\r\n            this.hero.runAction(heroMove);\r\n        }\r\n    },\r\n    landCreateAndMove(callFunc) {\r\n        var winSize = cc.director.getWinSize();\r\n        //firstland;\r\n        var length = this.currentLandRange + this.secondLand.width;\r\n        this.runLength +=length;\r\n        var action = cc.moveBy(this.moveDuration,cc.p(-length,0));\r\n        this.node.runAction(action);\r\n        this.firstLand = this.secondLand;\r\n\r\n        this.createNewLand();\r\n\r\n        //landRange\r\n        var range = this.getLandRange();\r\n\r\n        //secondland;\r\n        this.secondLand.setPosition(this.runLength+winSize.width,0);\r\n        var l = winSize.width - range - this.heroWorldPosX - this.hero.width * this.hero.anchorX - this.stickWidth;\r\n        var secondAction = cc.moveBy(this.moveDuration,cc.p(-l,0));\r\n        var seq =cc.sequence(secondAction,callFunc);\r\n        this.secondLand.runAction(seq);\r\n    },\r\n    createStick(){\r\n        cc.log(\"sc\");\r\n        var stick = spriteCreator.createStick(this.stickWidth);\r\n        stick.parent = this.node;\r\n        return stick\r\n    },\r\n    createNewLand() {\r\n        this.secondLand = spriteCreator.createNewLand(this.getLandWidth());\r\n        this.secondLand.parent = this.node;\r\n    },\r\n    getScore(num){\r\n        if(num){\r\n            this.score += num;  \r\n        }else{\r\n            this.score++;\r\n        }\r\n        if(storageManager.getHighestScore()<this.score){\r\n            storageManager.setHighestScore(this.score);\r\n            this.changeHightestScoreLabel();\r\n        }\r\n        this.scoreLabel.string = \"得分:\"+this.score;\r\n        return this.score;\r\n    },\r\n    changeHightestScoreLabel(){\r\n        this.hightestScoreLabel.string = \"最高分:\" + storageManager.getHighestScore();\r\n    },\r\n    getLandRange(){\r\n        this.currentLandRange = this.landRange.x +(this.landRange.y - this.landRange.x)*Math.random();\r\n        var winSize = cc.director.getWinSize();\r\n        if(winSize.width < this.currentLandRange + this.heroWorldPosX + this.hero.width + this.secondLand.width){\r\n            this.currentLandRange = winSize.width - this.heroWorldPosX - this.hero.width - this.secondLand.width;\r\n        }\r\n        return this.currentLandRange;\r\n    },\r\n    getLandWidth(){\r\n        return this.landWidth.x + (this.landWidth.y - this.landWidth.x)* Math.random();\r\n    }\r\n});\r\nmodule.exports = fsm;"]}