{"version":3,"sources":["enemy.js"],"names":["cc","Class","extends","Component","properties","xMinSpeed","default","type","Integer","tooltip","xMaxSpeed","yMinSpeed","yMaxSpeed","initHP","initSpriteFrame","SpriteFrame","score","enemyDownClip","AudioClip","onLoad","console","log","director","getCollisionManager","enabled","xSpeed","Math","random","ySpeed","enemyGroup","node","parent","getComponent","init","group","hP","nSprite","Sprite","spriteFrame","update","dt","eState","D","commonInfo","gameState","start","scores","getScore","y","x","height","enemyDied","onCollisionEnter","other","self","bullet","hpDrop","anim","Animation","animName","name","play","on","onFinished","audioEngine","playEffect","event"],"mappings":"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","file":"enemy.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        xMinSpeed: {\r\n            default:0,\r\n            type:cc.Integer,\r\n            tooltip: 'x轴最小速度',\r\n        },\r\n        xMaxSpeed: {\r\n            default:0,\r\n            type:cc.Integer,\r\n            tooltip: 'x轴最大速度',\r\n        },\r\n        yMinSpeed: {\r\n            default:0,\r\n            type:cc.Integer,\r\n            tooltip: 'y轴最小速度',\r\n        },\r\n        yMaxSpeed: { \r\n            default:0,\r\n            type:cc.Integer,\r\n            tooltip: 'y轴最大速度',\r\n        },\r\n        initHP: {\r\n            default:0,\r\n            type:cc.Integer,\r\n            tooltip: '初始生命值',\r\n        }, \r\n        initSpriteFrame:{\r\n            default: null,\r\n            type: cc.SpriteFrame,\r\n            tooltip: '初始化的图像'\r\n        }, \r\n        score: {\r\n            default:0,\r\n            type:cc.Integer,\r\n            tooltip: '死后获得的分数'\r\n\r\n        },\r\n        enemyDownClip: {\r\n            type: cc.AudioClip,\r\n            default: null\r\n        }\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        console.log('enemy onload');\r\n        cc.director.getCollisionManager().enabled=true;\r\n        \r\n        this.xSpeed = Math.random()*(this.xMaxSpeed-this.xMinSpeed) + this.xMinSpeed;\r\n        this.ySpeed = Math.random()*(this.yMaxSpeed-this.yMinSpeed) + this.yMinSpeed;\r\n        this.enemyGroup = this.node.parent.getComponent('enemyGroup');\r\n        \r\n    },\r\n    init: function(){\r\n        \r\n        if (this.node.group != 'enemy'){\r\n            this.node.group = 'enemy';\r\n        }\r\n        if (this.hP != this.initHP){\r\n            this.hP = this.initHP;\r\n        }\r\n        var nSprite = this.node.getComponent(cc.Sprite);\r\n        if (nSprite.spriteFrame != this.initSpriteFrame){\r\n            nSprite.spriteFrame = this.initSpriteFrame;\r\n        }\r\n        \r\n    },\r\n    \r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function (dt) {\r\n        if (this.enemyGroup.eState != D.commonInfo.gameState.start){\r\n            return ;\r\n        }\r\n        //分数不同 速度不同\r\n        var scores = this.enemyGroup.getScore();\r\n        if(scores<=50000){\r\n            this.node.y += dt*this.ySpeed;\r\n        }\r\n        else if(scores>50000&&scores<=100000){\r\n            this.node.y += dt*this.ySpeed-0.5;\r\n        }\r\n        else if(scores>100000&&scores<=150000){\r\n            this.node.y += dt*this.ySpeed-1;\r\n        }\r\n        else if(scores>150000&&scores<=200000){\r\n            this.node.y += dt*this.ySpeed-1.5;\r\n        }\r\n        else if(scores>200000&&scores<=300000){\r\n            this.node.y += dt*this.ySpeed-2;\r\n        } else{\r\n            this.node.y += dt*this.ySpeed-3;\r\n        }\r\n        this.node.x += dt*this.xSpeed;\r\n        //出屏幕后 回收节点\r\n        if (this.node.y < -this.node.parent.height/2){\r\n            this.enemyGroup.enemyDied(this.node,0);\r\n        }\r\n    },\r\n    //碰撞检测\r\n    onCollisionEnter: function(other,self){\r\n        if (other.node.group != 'bullet'){\r\n            return ;\r\n        }\r\n        var bullet = other.node.getComponent('bullet');\r\n        \r\n        if (this.hP>0){//防止再次碰撞\r\n            this.hP -= bullet.hpDrop;\r\n        } else {\r\n            return ;\r\n        }\r\n        if (this.hP <= 0){\r\n            this.node.group = 'default'; //不让动画在执行碰撞\r\n            //播放动画\r\n            var anim = this.getComponent(cc.Animation);\r\n            var animName = self.node.name + 'ani';\r\n            anim.play(animName);\r\n            anim.on('finished',  this.onFinished, this);\r\n            //播放音效\r\n            cc.audioEngine.playEffect(this.enemyDownClip, false);  \r\n        }\r\n    },\r\n    //动画结束后 动画节点回收\r\n    onFinished: function(event) { \r\n        this.enemyGroup.enemyDied(this.node, this.score);\r\n    },\r\n    \r\n});\r\n"]}