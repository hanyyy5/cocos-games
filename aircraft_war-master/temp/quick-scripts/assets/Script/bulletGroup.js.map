{"version":3,"sources":["bulletGroup.js"],"names":["bPosition","cc","Class","name","properties","xAxis","default","tooltip","yAxis","bulletInfinite","freqTime","initPollCount","prefab","Prefab","position","type","bulletFiniteG","extends","finiteTime","orginName","Component","hero","Node","onLoad","eState","D","commonInfo","gameState","none","common","initObjPool","batchInitObjPool","startAction","start","getNewbullet","bICallback","bind","schedule","pauseAction","enabled","pause","resumeAction","changeBullet","ufoBulletName","unschedule","bFCallback","bi","length","e","delay","macro","REPEAT_FOREVER","bulletInfo","poolName","bc","newNode","genNewNode","node","newV2","getBulletPostion","setPosition","getComponent","bulletGroup","posInfo","hPos","getPosition","newV2_x","x","eval","newV2_y","y","v2","bulletDied","nodeinfo","backObjPool"],"mappings":"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","file":"bulletGroup.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["//子弹生成位置\r\nvar bPosition = cc.Class({\r\n    name: 'bPosition',\r\n    properties: {\r\n        xAxis: {\r\n            default:'',\r\n            tooltip: '初始x轴，相对hero',\r\n        },\r\n        yAxis: {\r\n            default:'',\r\n            tooltip: '初始y轴，相对hero'\r\n        },\r\n    },\r\n});\r\n\r\n//不限时长子弹\r\nvar bulletInfinite = cc.Class({\r\n    name:'bulletInfinite',\r\n    properties: {\r\n        name:'',\r\n        freqTime:0,\r\n        initPollCount:0,\r\n        prefab:cc.Prefab,\r\n        position: {\r\n            default: [],\r\n            type: bPosition,\r\n            tooltip: '每次多少排子弹',\r\n        }\r\n    }\r\n});\r\n\r\n//有限时长子弹组\r\nvar bulletFiniteG = cc.Class({\r\n    name:'bulletFiniteG',\r\n    extends:bulletInfinite,\r\n    properties: {\r\n        finiteTime:0,\r\n        orginName:'',\r\n    }\r\n}); \r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties:()=> ({\r\n        bulletInfinite: {\r\n            default:null,\r\n            type: bulletInfinite,\r\n            tooltip:'无限时长子弹组'\r\n        },\r\n        bulletFiniteG: {\r\n            default:[],\r\n            type: bulletFiniteG,\r\n            tooltip:'有限时长子弹组'\r\n        },\r\n        hero: cc.Node,\r\n    }),\r\n    \r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this.eState = D.commonInfo.gameState.none;\r\n        //初始化无限子弹组\r\n        D.common.initObjPool(this,this.bulletInfinite);\r\n        //初始化🈶️限子弹组\r\n        D.common.batchInitObjPool(this,this.bulletFiniteG);\r\n    },\r\n    \r\n    startAction: function(){\r\n        this.eState = D.commonInfo.gameState.start;\r\n        //生成子弹\r\n        this.getNewbullet(this.bulletInfinite);\r\n        this.bICallback = function(){this.getNewbullet(this.bulletInfinite);}.bind(this);\r\n        this.schedule(this.bICallback, this.bulletInfinite.freqTime);\r\n        \r\n    },\r\n    pauseAction: function(){\r\n        this.enabled = false;\r\n        this.eState = D.commonInfo.gameState.pause;\r\n    },\r\n    resumeAction: function(){\r\n        this.enabled = true;\r\n        this.eState = D.commonInfo.gameState.start;\r\n    },\r\n    //换子弹\r\n    changeBullet: function(ufoBulletName){\r\n        this.unschedule(this.bICallback);\r\n        this.unschedule(this.bFCallback);\r\n        for (var bi=0; bi<this.bulletFiniteG.length; bi++){\r\n            \r\n            if (this.bulletFiniteG[bi].orginName == ufoBulletName){\r\n                this.bFCallback = function(e){this.getNewbullet(this.bulletFiniteG[e]);}.bind(this,bi);\r\n                this.schedule(this.bFCallback, this.bulletFiniteG[bi].freqTime,this.bulletFiniteG[bi].finiteTime);\r\n                var delay = this.bulletFiniteG[bi].freqTime * this.bulletFiniteG[bi].finiteTime;\r\n                this.schedule(this.bICallback,this.bulletInfinite.freqTime,cc.macro.REPEAT_FOREVER,delay);\r\n            }\r\n        }\r\n    },\r\n    //生成子弹\r\n    getNewbullet: function (bulletInfo) {\r\n        var poolName = bulletInfo.name + 'Pool';\r\n        for (var bc=0; bc<bulletInfo.position.length; bc++){\r\n            var newNode = D.common.genNewNode(this[poolName],bulletInfo.prefab,this.node);\r\n            var newV2 = this.getBulletPostion(bulletInfo.position[bc]);\r\n            newNode.setPosition(newV2);\r\n            newNode.getComponent('bullet').bulletGroup = this;\r\n        }\r\n    },\r\n    //获取子弹位置\r\n    getBulletPostion: function(posInfo){\r\n        var hPos = this.hero.getPosition();\r\n        var newV2_x = hPos.x + eval(posInfo.xAxis);\r\n        var newV2_y = hPos.y + eval(posInfo.yAxis);\r\n        return cc.v2(newV2_x, newV2_y); \r\n    },\r\n\r\n    //子弹灭亡\r\n    bulletDied: function(nodeinfo){\r\n        //回收节点\r\n        D.common.backObjPool(this,nodeinfo);\r\n    },\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}