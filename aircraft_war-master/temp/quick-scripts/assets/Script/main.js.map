{"version":3,"sources":["main.js"],"names":["cc","Class","extends","Component","properties","pause","Button","btnSprite","default","type","SpriteFrame","tooltip","bomb","Node","gameMusic","AudioSource","useBombClip","AudioClip","enemyGroup","require","hero","ufoGroup","bulletGroup","scoreDisplay","Label","bombNoDisplay","onLoad","score","bombNo","string","eState","D","commonInfo","gameState","start","startAction","on","bombOnclick","play","bombNoLabel","getChildByName","getComponent","parseInt","removeEnemy","audioEngine","playEffect","console","log","pauseClick","resumeAction","pauseAction","onDrag","resume","normalSprite","pressedSprite","hoverSprite","offDrag","gainScore","scoreno","toString","getScore","updateScore","currentScore","scoreData","common","timeFmt","Date","preData","sys","localStorage","getItem","preTopScore","setItem","unshift","JSON","parse","Array","stringify","node","removeAllChildren","getUfoBomb","gameOver","director","loadScene"],"mappings":"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","file":"main.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["\r\ncc.Class({\r\n    \r\n    extends: cc.Component,\r\n\r\n    properties:()=>({\r\n        pause: cc.Button,\r\n        btnSprite: {\r\n            default: [],\r\n            type: cc.SpriteFrame,\r\n            tooltip:'暂停按钮不同状态的图片',\r\n        },\r\n        \r\n        bomb: cc.Node,\r\n        gameMusic: {\r\n            default: null,\r\n            type: cc.AudioSource\r\n        },\r\n        useBombClip:  {\r\n            type: cc.AudioClip,\r\n            default: null\r\n        },\r\n        enemyGroup: {\r\n            default: null,\r\n            type: require('enemyGroup'),\r\n        },\r\n        hero: {\r\n            default: null,\r\n            type: require('hero'),\r\n        }, \r\n        ufoGroup: {\r\n            default: null,\r\n            type: require('ufoGroup'),\r\n        },\r\n        bulletGroup: {\r\n            default: null,\r\n            type: require('bulletGroup'),\r\n        },\r\n        scoreDisplay:cc.Label,\r\n        bombNoDisplay:cc.Label,\r\n    }),\r\n    \r\n    // use this for initialization\r\n    onLoad: function () {\r\n        \r\n        this.score = 0;\r\n        this.bombNo = 0;\r\n        this.scoreDisplay.string = this.score;\r\n        this.bombNoDisplay.string = this.bombNo;\r\n        this.eState = D.commonInfo.gameState.start;\r\n\r\n        this.enemyGroup.startAction();\r\n        this.bulletGroup.startAction();\r\n        this.ufoGroup.startAction();\r\n        this.bomb.on('touchstart',this.bombOnclick,this);\r\n        this.gameMusic.play();\r\n    },\r\n    \r\n    bombOnclick: function(){\r\n        var bombNoLabel = this.bomb.getChildByName('bombNo').getComponent(cc.Label);\r\n        var bombNo = parseInt(bombNoLabel.string);\r\n        \r\n        if (bombNo>0){\r\n            bombNoLabel.string = bombNo-1;\r\n            this.removeEnemy();\r\n            cc.audioEngine.playEffect(this.useBombClip, false);\r\n        } else {\r\n            console.log('没有子弹');\r\n        }\r\n    },\r\n    // called every frame, uncomment this function to activate update callback\r\n    //update: function (dt) {\r\n        \r\n    //},\r\n    \r\n    //暂停按钮点击事件  \r\n    pauseClick: function () {//暂停 继续\r\n    \r\n        if(this.eState == D.commonInfo.gameState.pause){\r\n            this.resumeAction();\r\n            this.eState = D.commonInfo.gameState.start;\r\n        } else if(this.eState == D.commonInfo.gameState.start) {\r\n            this.pauseAction();\r\n            this.eState = D.commonInfo.gameState.pause;\r\n        }\r\n    },\r\n    //游戏继续\r\n    resumeAction: function(){\r\n        this.enemyGroup.resumeAction();\r\n        this.bulletGroup.resumeAction();\r\n        this.ufoGroup.resumeAction();\r\n        this.hero.onDrag();\r\n        this.gameMusic.resume();\r\n        this.pause.normalSprite = this.btnSprite[0];\r\n        this.pause.pressedSprite = this.btnSprite[1];\r\n        this.pause.hoverSprite = this.btnSprite[1];\r\n    },\r\n    //游戏暂停\r\n    pauseAction: function(){\r\n        this.enemyGroup.pauseAction();\r\n            this.bulletGroup.pauseAction();\r\n            this.hero.offDrag();\r\n            this.gameMusic.pause();\r\n            this.ufoGroup.pauseAction();\r\n            this.pause.normalSprite = this.btnSprite[2];\r\n            this.pause.pressedSprite = this.btnSprite[3];\r\n            this.pause.hoverSprite = this.btnSprite[3];\r\n            \r\n    },\r\n    //增加分数\r\n    gainScore: function (scoreno) {\r\n        this.score += scoreno;\r\n        //更新 scoreDisplay Label 的文字\r\n        this.scoreDisplay.string = this.score.toString();\r\n    },\r\n    //get分数\r\n    getScore: function(){\r\n        return parseInt(this.scoreDisplay.string);\r\n    },\r\n    //分数写到本地（ 当前分 最高分 历史记录）\r\n    updateScore: function() {\r\n        var currentScore = this.scoreDisplay.string;\r\n        var scoreData = {\r\n            'score':currentScore,\r\n            'time': D.common.timeFmt(new Date(),'yyyy-MM-dd hh:mm:ss'),\r\n        };\r\n        var preData = cc.sys.localStorage.getItem('score');\r\n        var preTopScore = cc.sys.localStorage.getItem('topScore');\r\n        if (!preTopScore || parseInt(preTopScore) < parseInt(currentScore)){\r\n           cc.sys.localStorage.setItem('topScore', currentScore); \r\n        }\r\n        if(!preData){\r\n            preData = [];\r\n            preData.unshift(scoreData);\r\n            \r\n        } else {\r\n            preData = JSON.parse(preData);\r\n\t    if (!(preData instanceof Array)){\r\n                preData = [];    \r\n            }\r\n            preData.unshift(scoreData);\r\n        }\r\n        cc.sys.localStorage.setItem('currentScore', currentScore);\r\n        cc.sys.localStorage.setItem('score', JSON.stringify(preData));\r\n    },\r\n    //炸弹清除敌机\r\n    removeEnemy: function() {\r\n        this.enemyGroup.node.removeAllChildren();\r\n    },\r\n    //接到炸弹\r\n    getUfoBomb: function() { \r\n        if (parseInt(this.bombNoDisplay.string)<3){//多于三个炸弹就不累加\r\n            this.bombNoDisplay.string += 1;\r\n        }   \r\n    },\r\n    //游戏结束\r\n    gameOver: function(){ \r\n        this.pauseAction();\r\n        this.updateScore();\r\n        cc.director.loadScene('end');\r\n    },\r\n});\r\n"]}